machine:
    environment:
        ###################################################################
        # use also dynamic library installed by the cmake project         #
        ###################################################################
        LD_LIBRARY_PATH: /usr/local/lib/

checkout:
    post:
        ###################################################################
        # download submodules gtest/gmock and cppunit from original repos #
        ###################################################################
        - git submodule update --init --recursive

dependencies:
    pre:
        ###################################################################
        # installing additional tools to build destination project        #       
        ###################################################################
        # installing cmake 3.x with old cmake 2.x 
        - wget https://cmake.org/files/v3.9/cmake-3.9.0-rc5.tar.gz
        - tar xzvf cmake-3.9.0-rc5.tar.gz
        - cmake ./cmake-3.9.0-rc5/
        - sudo make      
        - sudo make install
        - rm -r CMakeCache.txt CMakeFiles        
        # installing autoconf
        - sudo apt-get update
        - sudo apt-get install autoconf
        # installing autotools
        - sudo apt-get install autotools-dev

compile:
    override:
        ###################################################################
        # build and install destination project and unit tests            #       
        ###################################################################
        - mkdir out
        - cd out
        - cmake -DDESTDIR=${PWD}/out ../module1
        - make DESTDIR=${PWD}/out
        - make install DESTDIR=${PWD}/out
	- export LD_LIBRARY_PATH=out/usr/local/lib/

test:
    override:
        ###################################################################
        # execute google unit tests for for compiled project              #       
        ###################################################################
        - ./out/usr/local/bin/timeKeeper_test1
        - ./out/usr/local/bin/smsDevice_test1
        - ./out/usr/local/bin/smsSender_test1
        - ./out/usr/local/bin/smsPlanner_test1
        ###################################################################
        # execute cppunit unit tests for for compiled project             #       
        ###################################################################
        - ./out/usr/local/bin/timeKeeper_test2
        - ./out/usr/local/bin/smsDevice_test2
        - ./out/usr/local/bin/smsSender_test2
        - ./out/usr/local/bin/smsPlanner_test2
        ###################################################################
        # build and install destination project and integration tests     #       
        ###################################################################
        - echo -e "add_definitions(-DIntegrationTests)\n$(cat module1/CMakeLists.txt)" > module1/CMakeLists.txt
        - rm -rf CMakeFiles CMakeCache.txt
        - cmake -DDESTDIR=${PWD}/out ../module1
        - make install DESTDIR=${PWD}/out
        - export LD_LIBRARY_PATH=out/usr/local/lib/
        ###################################################################
        # execute google integration tests for for compiled project       #       
        ###################################################################
        - ./out/usr/local/bin/timeKeeper_test1
        - ./out/usr/local/bin/smsDevice_test1
        - ./out/usr/local/bin/smsSender_test1
        - ./out/usr/local/bin/smsPlanner_test1
        ###################################################################
        # execute cppunit integration tests for for compiled project      #       
        ###################################################################
        - ./out/usr/local/bin/timeKeeper_test2
        - ./out/usr/local/bin/smsDevice_test2
        - ./out/usr/local/bin/smsSender_test2
        - ./out/usr/local/bin/smsPlanner_test2
